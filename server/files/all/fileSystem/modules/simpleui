-- vim: ft=lua
---@diagnostic disable: undefined-global, undefined-field, deprecated

local binds = {
	["up"] = 265,
	["down"] = 264,
	["enter"] = 257,
	["back"] = 259,
}

if os.about ~= nil then -- if using craft os pc emulator
	binds = {
		["up"] = 200,
		["down"] = 208,
		["enter"] = 28,
		["back"] = 14,
	}
end

function Clear(title) -- clear screen function, draws bars
	local resX, resY = term.getSize()
	term.setBackgroundColor(colors.black)
	term.clear()
	paintutils.drawBox(1, 1, resX, 1, colors.gray)
	term.setCursorPos(resX / 2 - #title / 2, 1)
	term.write(title)
	term.setCursorPos(1, resY)
	term.setBackgroundColor(colors.black)
	term.write("(up/down/enter/backspace): navigate")
end

function DrawChoices(choices, choiceDetails, scroll, title) -- draws a list of choices, bout it
	Clear(title)
	for i = 1 + scroll, math.min(#choices, (resY - 4) + scroll) do
		term.setCursorPos(4, i + 2 - scroll)
		print(choices[i])
		if choiceDetails ~= nil then
			term.setCursorPos(resX / 2, i + 2 - scroll)
			print(choiceDetails[i])
		end
	end
end

function GetChoice(choices, choiceDetails, title) -- gets user inputs and lets you select different choices
	local cursorPos = 1
	local scroll = 0
	DrawChoices(choices, choiceDetails, scroll, title)
	while true do
		paintutils.drawBox(2, 3, 2, resY - 2)
		term.setCursorPos(2, cursorPos + 2 - scroll)
		print(">")
		local _, key = os.pullEvent("key")
		if key == binds["up"] then
			cursorPos = math.max(cursorPos - 1, 1)
			if cursorPos < 1 + scroll then
				scroll = scroll - 1
				DrawChoices(choices, choiceDetails, scroll, title)
			end
		elseif key == binds["down"] then
			cursorPos = math.min(cursorPos + 1, #choices)
			if cursorPos > (resY - 4) + scroll then
				scroll = scroll + 1
				DrawChoices(choices, choiceDetails, scroll, title)
			end
		elseif key == binds["enter"] then
			return cursorPos
		elseif key == binds["back"] then
			return nil
		end
	end
end
